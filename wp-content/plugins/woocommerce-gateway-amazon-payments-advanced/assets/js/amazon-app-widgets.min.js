jQuery(function(t){var o,r,c,a=!1,i=amazon_payments_advanced_params.render_address_widget;function d(){void 0!==console.log&&console.log.apply(console,arguments)}function m(e){var a="";return"object"!=typeof e||("function"==typeof e.getErrorCode&&(a+="("+e.getErrorCode()+") "),"function"==typeof e.getErrorMessage&&(a+=e.getErrorMessage())),a}function s(e){e&&e.getAmazonOrderReferenceId&&(o=e.getAmazonOrderReferenceId()),n()}function _(e){o||(o=e.getAmazonOrderReferenceId(),n())}function n(){t("input.amazon-reference-id").remove();var e='<input class="amazon-reference-id" type="hidden" name="amazon_reference_id" value="'+o+'" />';t("form.checkout").append(e),t("form#order_review").append(e)}function u(e){if(!r){var a='<input class="amazon-billing-agreement-id" type="hidden" name="amazon_billing_agreement_id" value="'+(r=e.getAmazonBillingAgreementId())+'" />';t("form.checkout").append(a),t("form#order_review").append(a),t("#amazon_consent_widget").show()}}function e(){if(!a&&0!==t("#pay_with_amazon").length){var e={type:amazon_payments_advanced_params.button_type,color:amazon_payments_advanced_params.button_color,size:amazon_payments_advanced_params.button_size,authorization:function(){amazon.Login.authorize({scope:"profile postal_code payments:widget payments:shipping_address payments:billing_address"},amazon_payments_advanced_params.redirect)},onError:function(e){var a=m(e);d("Error encountered in OffAmazonPayments.Button",a?": "+a:"")}};""!==amazon_payments_advanced_params.button_language&&(e.language=amazon_payments_advanced_params.button_language),OffAmazonPayments.Button("pay_with_amazon",amazon_payments_advanced_params.seller_id,e),a=!0}}!function(){if(amazon&&amazon_payments_advanced_params.is_checkout&&amazon_payments_advanced_params.access_token){if(0===t(".create-account").length)return;amazon.Login.authorize({scope:"profile",interactive:"never"},function(e){if(e.error)return d("Error encountered in amazon.Login.authorize:",e.error);amazon.Login.retrieveProfile(function(e){if(e.success){var a=e.profile.Name.split(" ");t("#billing_first_name").val(a.shift()),t("#billing_last_name").val(a.join(" ")),t("#billing_email").val(e.profile.PrimaryEmail)}else d("Error encountered in amazon.Login.retrieveProfile:",e)})})}}(),e(),c=0<t("#amazon_addressbook_widget").length,i&&c?function(){var e={sellerId:amazon_payments_advanced_params.seller_id,onReady:function(){l(),t(document).trigger("wc_amazon_pa_widget_ready")},onOrderReferenceCreate:_,onAddressSelect:function(){t("body").trigger("update_checkout")},design:{designMode:"responsive"},onError:function(e){var a=m(e);d("Error encountered in OffAmazonPayments.Widgets.AddressBook",a?": "+a:"")}},a=amazon_payments_advanced_params.is_recurring,n=amazon_payments_advanced_params.declined_code;if("AmazonRejected"===n)return g();a&&(e.agreementType="BillingAgreement",e.onReady=function(e){u(e),l(),f(),t(document).trigger("wc_amazon_pa_widget_ready")});n&&(e.displayMode="Read",e.amazonOrderReferenceId=amazon_payments_advanced_params.reference_id,delete e.onOrderReferenceCreate);new OffAmazonPayments.Widgets.AddressBook(e).bind("amazon_addressbook_widget")}():l(),amazon_payments_advanced_params.multi_currency_supported&&amazon_payments_advanced_params.multi_currency_reload_wallet&&t(document.body).on("updated_checkout",function(){t.ajax({url:amazon_payments_advanced_params.ajax_url,type:"post",data:{action:"amazon_get_currency",nonce:amazon_payments_advanced_params.multi_currency_nonce},success:function(e){l(e)}})});var p=null;function l(e){if(!amazon_payments_advanced_params.declined_redirect_url){if(!p){var a={sellerId:amazon_payments_advanced_params.seller_id,design:{designMode:"responsive"},onError:function(e){var a=m(e);d("Error encountered in OffAmazonPayments.Widgets.Wallet",a?": "+a:"")}};amazon_payments_advanced_params.reference_id&&(o=amazon_payments_advanced_params.reference_id,a.amazonOrderReferenceId=o,a.onPaymentSelect=s),i&&c||(a.onOrderReferenceCreate=_),amazon_payments_advanced_params.is_recurring&&(a.agreementType="BillingAgreement",r?a.amazonBillingAgreementId=r:a.onReady=function(e){u(e),f()}),p=new OffAmazonPayments.Widgets.Wallet(a)}if(amazon_payments_advanced_params.multi_currency_supported){var n=e||amazon_payments_advanced_params.current_currency;p.setPresentmentCurrency(n)}p.bind("amazon_wallet_widget")}}function f(){amazon_payments_advanced_params.is_recurring&&r&&new OffAmazonPayments.Widgets.Consent({sellerId:amazon_payments_advanced_params.seller_id,amazonBillingAgreementId:r,design:{designMode:"responsive"},onConsent:function(e){var a=e.getConsentStatus();t("#place_order").css("opacity","true"==a?1:.5),t("#place_order").prop("disabled","true"!=a)},onError:function(e){var a=m(e);d("Error encountered in OffAmazonPayments.Widgets.Consent",a?": "+a:"")}}).bind("amazon_consent_widget")}function g(){amazon_payments_advanced_params.declined_redirect_url&&t("body").on("updated_checkout",function(){t("html, body").scrollTop(0),setTimeout(function(){window.location=amazon_payments_advanced_params.declined_redirect_url},3e3)})}function y(e,a){t(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),a.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+e+"</div>"),a.removeClass("processing").unblock(),a.find(".input-text, select, input:checkbox").trigger("validate").blur(),function(){var e=t(".woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout");e.length||(e=t(".form.checkout"));t.scroll_to_notices(e)}(),t(document.body).trigger("checkout_error")}t("body").on("click","#amazon-logout",function(){amazon.Login.logout()}),t("form.checkout").on("checkout_place_order",function(){var e=[":input[name=billing_email]",":input[name=billing_first_name]",":input[name=billing_last_name]",":input[name=account_username]",":input[name=account_password]",":input[name=createaccount]"].join(",");t(this).find(e).each(function(){var e=t(this);""===e.val()&&e.is(":hidden")&&e.attr("disabled","disabled"),"createaccount"===e.attr("name")&&t("#createaccount").length&&e.prop("checked",t("#createaccount").is(":checked"))})}),t("body").on("updated_checkout",e),t("body").on("updated_cart_totals",function(){a=!1,e()}),t(window.document).on("wc_amazon_pa_widget_ready",function(){g()}),t("form.checkout").on("checkout_place_order",function(e){if("amazon_payments_advanced"!==t("input[name=payment_method]:checked").val())return!0;if(!amazon_payments_advanced_params.is_sca)return!0;var a=t(this);return OffAmazonPayments.initConfirmationFlow(amazon_payments_advanced_params.seller_id,o,function(e){!function(o,r){r.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),t.ajax({type:"post",url:amazon_payments_advanced_params.ajax_url,data:{action:"amazon_sca_processing",nonce:amazon_payments_advanced_params.sca_nonce,data:t("form.checkout").serialize()},success:function(e){if("success"===e.result)o.success();else if("failure"===e.result){if(o.error(),!0===e.reload)return void window.location.reload();!0===e.refresh&&t(document.body).trigger("update_checkout"),y(e.messages,r)}},error:function(e,a,n){o.error(),y('<div class="woocommerce-error">'+n+"</div>",r)}})}(e,a)}),e.preventDefault(),!1})});
