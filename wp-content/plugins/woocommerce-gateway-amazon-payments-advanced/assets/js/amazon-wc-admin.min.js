!function(n){var e={key_box_id:"woocommerce_amazon_payments_advanced_keys_json",are_keys_set:amazon_admin_params.keys_already_set,init:function(){this.are_keys_set&&e.hide_key_box(),n("label[for="+this.key_box_id+"]").click(function(){e.show_key_box()})},hide_key_box:function(){n("#"+this.key_box_id).hide()},show_key_box:function(){n("#"+this.key_box_id).show()}};e.init();var a={simple_path_form_id:"simple_path",payment_region_input:n("#woocommerce_amazon_payments_advanced_payment_region"),json_key_input:n("#woocommerce_amazon_payments_advanced_keys_json"),action_url:"#",spId:"",register_now_link:n("a.register_now"),locale:amazon_admin_params.locale,home_url:amazon_admin_params.home_url,merchant_unique_id:amazon_admin_params.merchant_unique_id,public_key:amazon_admin_params.public_key,exchange_url:amazon_admin_params.simple_path_url,privacy_url:amazon_admin_params.privacy_url,site_description:amazon_admin_params.description,poll_timer:!1,poll_interval:3e3,init:function(){a.payment_region_on_change(),a.create_form(),a.payment_region_input.on("change",this.payment_region_on_change),a.json_key_input.on("change paste keyup",this.json_key_on_change),a.register_now_link.on("click",this.register_link_on_click)},payment_region_on_change:function(){"jp"===a.get_region_selected()?(a.register_now_link.attr("href",a.get_simple_path_url()),a.register_now_link.attr("target","_blank")):(a.register_now_link.attr("href","#"),a.register_now_link.removeAttr("target"),a.action_url=a.get_simple_path_url(),a.spId=a.get_spId(),n("#"+a.simple_path_form_id).attr("action",a.action_url),n("input[name=spId]").val(a.spId))},json_key_on_change:function(){try{var e=n.parseJSON(n(this).val());a.json_key_input.removeClass("json_key_error"),a.json_key_input.addClass("json_key_valid"),n("#woocommerce_amazon_payments_advanced_seller_id").val(e.merchant_id),n("#woocommerce_amazon_payments_advanced_mws_access_key").val(e.access_key),n("#woocommerce_amazon_payments_advanced_secret_key").val(e.secret_key),n("#woocommerce_amazon_payments_advanced_app_client_id").val(e.client_id),n("#woocommerce_amazon_payments_advanced_app_client_secret").val(e.client_secret)}catch(e){a.json_key_input.removeClass("json_key_valid"),a.json_key_input.addClass("json_key_error")}},register_link_on_click:function(){"jp"!==a.get_region_selected()&&(document.getElementById(a.simple_path_form_id).submit.click(),a.poll_timer=setTimeout(a.poll_for_keys,a.poll_interval))},create_form:function(){n(".wrap.woocommerce").append(n("<form/>",{id:a.simple_path_form_id,action:a.action_url,method:"post",target:"_blank"}).append(n("<input/>",{type:"hidden",name:"spId",value:a.spId}),n("<input/>",{type:"hidden",name:"publicKey",value:a.public_key}),n("<input/>",{type:"hidden",name:"keyShareURL",value:a.exchange_url}),n("<input/>",{type:"hidden",name:"locale",value:a.locale}),n("<input/>",{type:"hidden",name:"merchantLoginDomains[]",value:a.home_url}),n("<input/>",{type:"hidden",name:"merchantLoginRedirectURLs[]",value:a.exchange_url}),n("<input/>",{type:"hidden",name:"merchantPrivacyNoticeURL",value:a.privacy_url}),n("<input/>",{type:"hidden",name:"merchantStoreDescription",value:a.site_description}),n("<input/>",{type:"hidden",name:"source",value:"SPPL"}),n("<input/>",{type:"submit",name:"submit",style:"display:none",value:"submit"})))},get_region_selected:function(){return a.payment_region_input.val()},get_simple_path_url:function(){return amazon_admin_params.simple_path_urls[a.get_region_selected()]},get_spId:function(){return amazon_admin_params.spids[a.get_region_selected()]},poll_for_keys:function(){clearTimeout(a.poll_timer),n.ajax({url:amazon_admin_params.ajax_url,data:{action:"amazon_check_credentials",nonce:amazon_admin_params.credentials_nonce},type:"GET",success:function(e){"1"===e?location.reload():a.poll_timer=setTimeout(a.poll_for_keys,a.poll_interval)}})}};a.init()}(jQuery);
